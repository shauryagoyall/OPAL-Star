# -*- coding: utf-8 -*-
"""
Created on Thu Jun 30 19:23:23 2022

@author: 91845
"""

import numpy as np
import torch
import torch.nn as nn
import torch.nn.functional as F

import math

import torch
import torch.nn as nn
import torch.nn.functional as F

"""
Modify standard PyTorch distributions so they are compatible with this code.
"""

#
# Standardize distribution interfaces
#

# Categorical
class FixedCategorical(torch.distributions.Categorical):
    def sample(self):
        return super().sample().unsqueeze(-1)

    def log_probs(self, actions):

        return (
            super()
            .log_prob(actions.squeeze(-1))
            .view(actions.size(0), -1)
            .sum(-1)
            .unsqueeze(-1)
        )

    def mode(self):
        return self.probs.argmax(dim=-1, keepdim=True)

def init(module, weight_init, bias_init, gain=1):
    weight_init(module.weight.data, gain=gain)
    bias_init(module.bias.data)
    return module


class Categorical(nn.Module):
    def __init__(self, num_inputs, num_outputs):
        super(Categorical, self).__init__()

        init_ = lambda m: init(
            m,
            nn.init.orthogonal_,
            lambda x: nn.init.constant_(x, 0),
            gain=0.01)

        self.linear = init_(nn.Linear(num_inputs, num_outputs))

    def forward(self, x):
        x = self.linear(x)
        return FixedCategorical(logits=x)


m = Categorical(512,4)
b = np.array([float(x) for x in range(512)])
a=torch.from_numpy(b).type(torch.LongTensor)

c=torch.tensor([0.0358, 0.0289, 0.0000, 0.1123, 0.0000, 0.0000, 0.0000, 0.0000, 0.3144,
        0.0928, 0.1232, 0.0077, 0.2266, 0.0000, 0.2065, 0.0000, 0.0116, 0.0486,
        0.0000, 0.1037, 0.0000, 0.0000, 0.0666, 0.0000, 0.1477, 0.0000, 0.1695,
        0.0455, 0.0000, 0.0000, 0.0000, 0.0000, 0.1351, 0.0000, 0.0000, 0.0000,
        0.0000, 0.0000, 0.0000, 0.0807, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
        0.0735, 0.0000, 0.1355, 0.1748, 0.0000, 0.0102, 0.1601, 0.2406, 0.1098,
        0.0000, 0.0000, 0.0000, 0.0000, 0.2099, 0.1081, 0.1502, 0.0739, 0.0133,
        0.0000, 0.0000, 0.0128, 0.0812, 0.0147, 0.0152, 0.1489, 0.0000, 0.0000,
        0.2496, 0.0279, 0.0000, 0.0250, 0.2087, 0.2959, 0.0000, 0.0000, 0.0000,
        0.0000, 0.0000, 0.0000, 0.0000, 0.1432, 0.0073, 0.1530, 0.0405, 0.0000,
        0.0000, 0.0000, 0.0000, 0.0012, 0.0000, 0.0595, 0.0310, 0.0000, 0.0876,
        0.0249, 0.0475, 0.2012, 0.0048, 0.1600, 0.1567, 0.0207, 0.0000, 0.0000,
        0.0000, 0.0666, 0.0867, 0.0680, 0.0144, 0.0382, 0.0000, 0.0000, 0.0158,
        0.0733, 0.0000, 0.0000, 0.1643, 0.2894, 0.1352, 0.1354, 0.0975, 0.0000,
        0.2554, 0.0781, 0.0761, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.1385,
        0.0000, 0.0000, 0.0601, 0.0000, 0.0549, 0.1568, 0.0000, 0.0000, 0.0000,
        0.1366, 0.0228, 0.0000, 0.0000, 0.3459, 0.0722, 0.0000, 0.0000, 0.0000,
        0.0000, 0.1488, 0.0000, 0.0000, 0.0000, 0.1254, 0.0000, 0.0394, 0.0000,
        0.1024, 0.0581, 0.0248, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.1851,
        0.0192, 0.1069, 0.0000, 0.0000, 0.0000, 0.2561, 0.0000, 0.1409, 0.0190,
        0.0416, 0.0000, 0.0000, 0.0000, 0.0904, 0.0000, 0.0000, 0.0806, 0.0000,
        0.0000, 0.0000, 0.0000, 0.0000, 0.2008, 0.0000, 0.0000, 0.0000, 0.0000,
        0.0000, 0.1796, 0.0000, 0.2279, 0.0000, 0.0000, 0.0000, 0.0677, 0.0415,
        0.0000, 0.0000, 0.0000, 0.0000, 0.0525, 0.0000, 0.0554, 0.0000, 0.2028,
        0.0000, 0.2193, 0.0155, 0.0000, 0.0000, 0.0116, 0.0089, 0.0000, 0.0000,
        0.0000, 0.0000, 0.0611, 0.1837, 0.0000, 0.0039, 0.0316, 0.0000, 0.0000,
        0.0597, 0.0593, 0.1798, 0.0000, 0.0063, 0.0123, 0.0000, 0.2382, 0.0000,
        0.0561, 0.0000, 0.1232, 0.0000, 0.0000, 0.0000, 0.0376, 0.0000, 0.0000,
        0.0000, 0.0000, 0.0857, 0.0983, 0.0240, 0.0381, 0.0000, 0.0000, 0.0000,
        0.0000, 0.0000, 0.1038, 0.0174, 0.0000, 0.0213, 0.1490, 0.0000, 0.2899,
        0.1473, 0.0000, 0.2063, 0.0000, 0.0710, 0.0000, 0.0012, 0.0000, 0.1631,
        0.0258, 0.0000, 0.0000, 0.0000, 0.0000, 0.0512, 0.0444, 0.0000, 0.1583,
        0.2738, 0.0000, 0.0513, 0.0000, 0.0370, 0.2189, 0.0000, 0.0000, 0.1579,
        0.0855, 0.0000, 0.2137, 0.0006, 0.0592, 0.0772, 0.0000, 0.0000, 0.0678,
        0.1686, 0.0627, 0.0000, 0.0000, 0.1704, 0.0000, 0.1035, 0.0349, 0.0283,
        0.0000, 0.0000, 0.0000, 0.0000, 0.0578, 0.0856, 0.0022, 0.1672, 0.0866,
        0.0000, 0.0000, 0.0411, 0.1469, 0.0122, 0.0000, 0.1197, 0.0491, 0.0000,
        0.0795, 0.0000, 0.0000, 0.1322, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000,
        0.0166, 0.1669, 0.0436, 0.0000, 0.0000, 0.0000, 0.1202, 0.1067, 0.1309,
        0.0256, 0.0000, 0.1763, 0.1944, 0.0716, 0.3173, 0.1360, 0.0946, 0.1265,
        0.0537, 0.1012, 0.0430, 0.0234, 0.0000, 0.1582, 0.0159, 0.1234, 0.0000,
        0.0000, 0.0000, 0.0000, 0.0000, 0.0748, 0.2930, 0.0000, 0.1803, 0.1776,
        0.0000, 0.0490, 0.1081, 0.0000, 0.0914, 0.0000, 0.0000, 0.0000, 0.0000,
        0.0988, 0.0000, 0.0000, 0.0447, 0.1102, 0.0000, 0.0378, 0.0260, 0.0522,
        0.0000, 0.0057, 0.0000, 0.0000, 0.0000, 0.1908, 0.0537, 0.0000, 0.0000,
        0.0000, 0.0000, 0.0549, 0.0000, 0.0771, 0.0000, 0.1048, 0.0000, 0.2804,
        0.2309, 0.0071, 0.2009, 0.0300, 0.0000, 0.0000, 0.0000, 0.0834, 0.0076,
        0.1821, 0.0709, 0.0000, 0.0000, 0.0805, 0.0339, 0.1643, 0.1099, 0.0853,
        0.1653, 0.0732, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0145, 0.0560,
        0.0000, 0.0917, 0.0000, 0.2242, 0.0882, 0.0000, 0.0000, 0.1449, 0.0216,
        0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.2082, 0.0000, 0.0000, 0.0200,
        0.0000, 0.1181, 0.0989, 0.0474, 0.0066, 0.1234, 0.0000, 0.1101, 0.0270,
        0.2735, 0.0000, 0.3179, 0.0845, 0.1396, 0.0000, 0.0328, 0.1455, 0.0000,
        0.1669, 0.0000, 0.0000, 0.0000, 0.0267, 0.0000, 0.0000, 0.0000, 0.0347,
        0.0882, 0.0000, 0.0000, 0.1286, 0.0000, 0.0000, 0.2057, 0.0195, 0.0147,
        0.0073, 0.0000, 0.2459, 0.0185, 0.0000, 0.0000, 0.1570, 0.0000, 0.0000,
        0.0000, 0.1843, 0.0000, 0.0000, 0.1010, 0.1052, 0.0000, 0.0829])